# 🤖 STORIUM Bot - 카카오톡 통합 봇 시스템

> 카카오톡 메신저봇R과 연동되는 다기능 통합 봇 시스템

## 📋 목차
- [주요 기능](#-주요-기능)
- [시스템 구조](#-시스템-구조)
- [설치 방법](#-설치-방법)
- [실행 방법](#-실행-방법)
- [명령어 목록](#-명령어-목록)
- [설정 방법](#-설정-방법)
- [문제 해결](#-문제-해결)

## ✨ 주요 기능

### 🎯 핵심 특징
- **31개 명령어** 100% 작동
- **4초 타임아웃** 처리로 안정성 보장
- **5초 응답 캐시**로 중복 요청 방지
- **중앙 설정 관리** 시스템
- **권한 관리** (관리자/일반 사용자)

### 📊 카테고리별 기능
- **AI 대화**: GPT, Claude, Gemini 통합
- **실시간 정보**: 날씨, 주식, 환율, 코인
- **검색**: 네이버 검색, 블로그, 뉴스
- **엔터테인먼트**: 영화순위, 로또, 유튜브
- **유틸리티**: 지도, 부동산, 칼로리, 이모지
- **게임**: LOL 전적 조회
- **관리**: 방 관리, 재부팅

## 🏗️ 시스템 구조

```
kakaoBot-main/
│
├── 📌 핵심 파일
│   ├── main_improved.py      # FastAPI 서버 (메인)
│   ├── fn.py                 # 명령어 처리 로직 (3200줄+)
│   ├── config.py             # 중앙 설정 관리
│   └── command_manager.py    # 명령어 정보 관리
│
├── 📦 API 모듈
│   ├── naver.py             # 네이버 API
│   └── stock_improved.py    # 주식 정보 API
│
├── 🎬 movie_modules/         # 영화 순위 모듈
├── 🛠️ utils/                 # 유틸리티
├── 📚 docs/                  # 문서
└── 📄 기타 파일
```

### 작동 흐름
```
카카오톡 → 메신저봇R → FastAPI 서버 → 명령어 처리 → 응답
```

## 🚀 설치 방법

### 1. 필수 요구사항
- Python 3.8 이상
- 메신저봇R 앱
- ngrok (외부 접속용)

### 2. 패키지 설치
```bash
pip install -r requirements.txt
```

### 3. Playwright 설치 (영화순위용)
```bash
playwright install chromium
```

## 🎮 실행 방법

### 방법 1: 직접 실행
```bash
python main_improved.py
```

### 방법 2: 배치 파일 (Windows)
```bash
start_server.bat
```

### 방법 3: Shell 스크립트 (Linux/Mac)
```bash
./start_server.sh
```

### 4. ngrok 실행 (외부 접속)
```bash
ngrok http 8000
```

## 📝 명령어 목록

### AI & 기본
| 명령어 | 설명 | 예시 |
|--------|------|------|
| `?` | AI가 답변 | `?저녁메뉴 추천` |
| `/명령어` | 명령어 목록 | `/명령어` |

### 정보 조회
| 명령어 | 설명 | 예시 |
|--------|------|------|
| `/날씨` | 지역 날씨 | `/날씨 강남구` |
| `/주식` | 주식 정보 | `/주식 삼성전자` |
| `/환율` | 실시간 환율 | `/환율` |
| `/코인` | 코인 TOP 10 | `/코인` |
| `/금값` | 금 시세 | `/금값` |

### 검색
| 명령어 | 설명 | 예시 |
|--------|------|------|
| `/실시간검색어` | 실시간 검색어 | `/실시간검색어` |
| `/뉴스` | 실시간 뉴스 | `/뉴스` |
| `/블로그` | 블로그 검색 | `/블로그 파이썬` |

### 엔터테인먼트
| 명령어 | 설명 | 예시 |
|--------|------|------|
| `/영화순위` | 어제 영화순위 | `/영화순위` |
| `/로또` | 로또 번호 생성 | `/로또` |
| `/인급동` | 유튜브 인기영상 | `/인급동` |

### 유틸리티
| 명령어 | 설명 | 예시 |
|--------|------|------|
| `/지도` | 네이버지도 | `/지도 강남 맛집` |
| `/부동산` | 부동산 검색 | `/부동산 성수트리마제` |
| `/칼로리` | 음식 칼로리 | `/칼로리 감자` |
| `/이모지` | 이모지 검색 | `/이모지 강아지` |

### 관리자 전용
| 명령어 | 설명 | 예시 |
|--------|------|------|
| `/방추가` | 방 추가 | `/방추가 테스트방` |
| `/방삭제` | 방 삭제 | `/방삭제 테스트방` |
| `/방목록` | 방 목록 | `/방목록` |
| `/재부팅` | 기기 재부팅 | `/재부팅` |

> 전체 31개 명령어 - 자세한 목록은 `/명령어` 입력

## ⚙️ 설정 방법

### config.py 수정
```python
BOT_CONFIG = {
    "ALLOWED_ROOMS": ['이국환', '테스트방'],  # 허용된 방
    "ADMIN_USERS": ['이국환'],               # 관리자
    "ADMIN_ROOM": "이국환",                  # 관리자 방
    "BOT_NAME": "STORIUM Bot",
    "VERSION": "2.0.0"
}

# API 키 설정
API_KEYS = {
    "GEMINI": "your-gemini-api-key",
    "CLAUDE": "your-claude-api-key",
    "OPENAI": "your-openai-api-key",
    "YOUTUBE": "your-youtube-api-key"
}
```

### 메신저봇R 설정
1. 메신저봇R 앱 실행
2. 새 봇 생성 (이름: STORIUM Bot)
3. `메신저r.js` 코드 복사
4. API URL 설정: `http://your-ngrok-url/`
5. 봇 활성화

## 🔧 문제 해결

### 서버가 시작되지 않을 때
```bash
# 포트 확인
netstat -an | findstr :8000

# 프로세스 종료
taskkill /F /PID [프로세스ID]
```

### 명령어가 작동하지 않을 때
1. `config.py`에서 방 이름 확인
2. 관리자 권한 확인
3. API 키 설정 확인

### 영화순위가 안 나올 때
```bash
# Playwright 재설치
playwright install chromium
```

### 로그 확인
```bash
# 디버그 로그 확인
tail -f debug_logs/debug_*.log
```

## 📊 시스템 상태

- **총 명령어**: 31개
- **작동률**: 100%
- **응답 시간**: < 4초
- **캐시 시간**: 5초
- **메시지 제한**: 1000자

## 🚨 주의사항

### ⚠️ 삭제하면 안 되는 파일
- `fn.py` - 모든 명령어 처리 로직 (절대 삭제 금지!)
- `command_manager.py` - 명령어 정보 관리
- `main_improved.py` - 서버 운영
- `config.py` - 설정 관리

### 📝 유지보수 팁
- 명령어 추가: `command_manager.py`의 `ALL_COMMANDS`에 추가
- 로직 구현: `fn.py`에 함수 추가
- 설정 변경: `config.py` 수정 후 서버 재시작

## 📈 최근 업데이트

### v2.0.0 (2025.08.06)
- ✅ 명령어 시스템 통합 완료
- ✅ 타임아웃 처리 개선
- ✅ 응답 캐시 시스템 추가
- ✅ 중앙 설정 관리 구현
- ❌ 쿠팡 기능 제거 (API 차단)

## 📄 라이선스

이 프로젝트는 개인 사용 목적으로 제작되었습니다.

## 🤝 기여

문제 발견 시 이슈를 등록해주세요.

---

**Made with ❤️ by STORIUM Bot Team**

*마지막 업데이트: 2025년 8월 6일*